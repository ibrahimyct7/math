<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neural Hub</title>
    
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="apple-touch-icon" href="logo.png">
    <link rel="manifest" href='data:application/json,{"name":"Neural Hub","short_name":"Hub","start_url":".","display":"standalone","background_color":"#0d1a0f","theme_color":"#162b1a","icons":[{"src":"logo.png","sizes":"192x192","type":"image/png"},{"src":"logo.png","sizes":"512x512","type":"image/png"}]}'>

    <style>
        :root {
            --bg: #0d1a0f;
            --panel: #162b1a;
            --cream: #f1f8e9;
            --mint: #a5d6a7;
            --btn-dark: #081209;
            --math: #4caf50; --word: #2196f3; --color: #ff5722; --seq: #ffeb3b; --patt: #9c27b0;
            --easy: #a5d6a7; --hard: #ffb74d; --god: #f44336;
        }

        body {
            margin: 0; padding: 0; font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--bg); color: var(--cream);
            display: flex; justify-content: center; align-items: center; min-height: 100vh;
            overflow: hidden; touch-action: manipulation;
        }

        #app {
            background: var(--panel); padding: 1.8rem 1.2rem; border-radius: 40px;
            box-shadow: 0 25px 60px rgba(0,0,0,0.6); text-align: center;
            width: 92%; max-width: 380px; border: 1px solid rgba(255,255,255,0.08);
            position: relative; transition: background-color 0.3s;
        }

        #global-rank { font-size: 0.7rem; font-weight: 900; letter-spacing: 2px; color: var(--seq); margin-bottom: 15px; text-transform: uppercase; }

        .view-section { width: 100%; display: flex; flex-direction: column; align-items: center; }
        .hidden { display: none !important; }

        .portal-item {
            display: flex; align-items: center; width: 100%; 
            background: var(--btn-dark); border-radius: 25px; 
            padding: 8px 12px; margin-bottom: 12px; box-sizing: border-box;
            border: 1px solid rgba(255,255,255,0.02);
        }
        .btn-main {
            flex-grow: 1; padding: 16px; border: none; border-radius: 18px;
            font-weight: 800; font-size: 1rem; cursor: pointer; text-align: left;
            display: flex; align-items: center; gap: 15px; letter-spacing: 1px;
        }
        
        .sym { font-family: serif; font-size: 1.4rem; font-weight: bold; width: 25px; text-align: center; }

        .prog-box { position: relative; width: 42px; height: 42px; display: flex; align-items: center; justify-content: center; margin-left: 10px; }
        .prog-svg { transform: rotate(-90deg); width: 42px; height: 42px; }
        .prog-bg { fill: none; stroke: rgba(255,255,255,0.05); stroke-width: 4; }
        .prog-bar { fill: none; stroke-width: 4; stroke-linecap: round; transition: stroke-dashoffset 0.6s ease; }
        .prog-txt { position: absolute; font-size: 0.65rem; font-weight: 800; color: var(--mint); }

        .game-header { font-size: 0.75rem; font-weight: 800; color: var(--mint); margin-bottom: 10px; opacity: 0.8; letter-spacing: 1px; }

        #q-text { font-size: 2.2rem; margin: 15px 0; font-weight: 900; min-height: 130px; display: flex; align-items: center; justify-content: center; text-align: center; }
        .v-list { display: flex; flex-direction: column; gap: 10px; width: 100%; }
        
        button { cursor: pointer; transition: 0.2s; font-family: inherit; border: none; }
        .btn-choice { padding: 16px; border-radius: 20px; background: var(--btn-dark); color: var(--cream); font-weight: 700; font-size: 1.1rem; border: 1px solid rgba(255,255,255,0.05); }
        .btn-choice:disabled { opacity: 0.8; }

        input[type="text"] { width: 100%; padding: 18px; border-radius: 20px; border: 2px solid var(--mint); background: var(--btn-dark); color: white; font-size: 1.3rem; text-align: center; outline: none; margin-bottom: 10px; box-sizing: border-box; }

        .f-right { background-color: #1b4d21 !important; }
        .f-wrong { background-color: #5d1a1a !important; }
        .shake { animation: shake 0.4s ease; }
        @keyframes shake { 0%,100%{transform:translateX(0)} 20%{transform:translateX(-10px)} 40%{transform:translateX(10px)} 60%{transform:translateX(-10px)} 80%{transform:translateX(10px)} }

        #timer-box { width: 100%; height: 6px; background: rgba(0,0,0,0.3); border-radius: 10px; margin-bottom: 15px; display: none; overflow: hidden; }
        #timer-bar { height: 100%; background: var(--mint); width: 100%; }
        
        .btn-nav { background: transparent; color: var(--mint); border: 1px solid rgba(255,255,255,0.1); padding: 12px; font-size: 0.8rem; border-radius: 15px; font-weight: bold; margin-top: 10px; width: 100%; }
    </style>
</head>
<body>

<div id="app">
    <div id="global-rank">RANK: SEEDLING</div>
    <div id="timer-box"><div id="timer-bar"></div></div>

    <div id="v-hub" class="view-section">
        <h1 style="color:var(--mint); margin:0; font-size:1.6rem;">Neural Hub</h1>
        <p style="opacity:0.4; font-size:0.7rem; margin-bottom:20px; letter-spacing: 1px;">CORE COGNITION TRAINER</p>
        <div class="v-list">
            <div class="portal-item"><button class="btn-main" style="background:var(--math); color:#000;" onclick="goPortal('math')"><span class="sym">‚àë</span> MATH</button><div class="prog-box" id="p-math"></div></div>
            <div class="portal-item"><button class="btn-main" style="background:var(--word); color:#fff;" onclick="goPortal('word')"><span class="sym">Aa</span> WORDS</button><div class="prog-box" id="p-word"></div></div>
            <div class="portal-item"><button class="btn-main" style="background:var(--color); color:#fff;" onclick="goPortal('color')"><span class="sym">‚óê</span> COLORS</button><div class="prog-box" id="p-color"></div></div>
            <div class="portal-item"><button class="btn-main" style="background:var(--seq); color:#000;" onclick="goPortal('seq')"><span class="sym">‚ó∞</span> RECALL</button><div class="prog-box" id="p-seq"></div></div>
            <div class="portal-item"><button class="btn-main" style="background:var(--patt); color:#fff;" onclick="goPortal('patt')"><span class="sym">‚ñ§</span> PATTERN</button><div class="prog-box" id="p-patt"></div></div>
        </div>
    </div>

    <div id="v-math-ops" class="view-section hidden">
        <h1 style="font-size:1.2rem;">Select Operation</h1>
        <div class="v-list" style="margin-top:20px;">
            <button class="btn-choice" onclick="pickMathOp('add')">ADDITION +</button>
            <button class="btn-choice" onclick="pickMathOp('sub')">SUBTRACTION -</button>
            <button class="btn-choice" onclick="pickMathOp('mul')">MULTIPLICATION √ó</button>
            <button class="btn-choice" onclick="pickMathOp('mix')">MIXED MODE ¬±√ó</button>
            <button class="btn-nav" onclick="resetHub()">‚Üê BACK TO HUB</button>
        </div>
    </div>

    <div id="v-opt" class="view-section hidden">
        <h1 id="opt-title" style="font-size:1.2rem;">Challenge Pace</h1>
        <div id="type-list" class="v-list" style="margin-top:20px;">
            <button class="btn-choice" onclick="setOpt('relaxed')">RELAXED</button>
            <button class="btn-choice" style="background:#3e2723; color:white" onclick="setOpt('timed')">TIMED</button>
            <button class="btn-nav" id="back-from-type" onclick="resetHub()">‚Üê BACK</button>
        </div>
    </div>

    <div id="v-diff" class="view-section hidden">
        <h1 style="font-size:1.2rem;">Difficulty</h1>
        <div class="v-list" style="margin-top:20px;">
            <button class="btn-choice" style="color:var(--easy)" onclick="start('easy')">EASY</button>
            <button class="btn-choice" style="color:var(--hard)" onclick="start('hard')">HARD</button>
            <button class="btn-choice" style="color:var(--god)" onclick="start('god')">GOD MODE</button>
            <button class="btn-nav" onclick="backToType()">‚Üê PREVIOUS PAGE</button>
        </div>
    </div>

    <div id="v-game" class="view-section hidden">
        <div class="game-header">QUESTION <span id="q-cur">1</span> OF 10</div>
        <div id="q-text">--</div>
        <div id="input-area" class="v-list">
            <div id="choices" class="v-list"></div>
            <div id="text-area" class="hidden">
                <input type="text" id="ans-in" placeholder="..." autocomplete="off">
                <button id="text-submit" class="btn-choice" style="background:var(--math); color:#000; width:100%" onclick="checkText()">SUBMIT</button>
            </div>
        </div>
        <button class="btn-nav" style="margin-top:20px;" onclick="resetHub()">QUIT TO HUB</button>
    </div>

    <div id="v-res" class="view-section hidden">
        <h1 id="res-emoji" style="font-size:4rem; margin:0;">üèÜ</h1>
        <h2 id="res-title">Test Complete</h2>
        <p style="font-size: 3.5rem; margin: 10px 0;"><span id="res-score">0</span><span style="font-size:1.5rem">/10</span></p>
        <div class="v-list">
            <button class="btn-choice" style="background:var(--math); color:black;" onclick="tryAgain()">TRY AGAIN</button>
            <button class="btn-nav" onclick="resetHub()">BACK TO HUB</button>
        </div>
    </div>
</div>

<script>
    let curP = '', curM = '', curT = '', curD = '', curS = 0, qN = 0, cAns = '', tInt;
    let sessionWords = [];

    const names = ["RED", "BLUE", "GREEN", "YELLOW", "ORANGE", "WHITE"];
    const vColors = ["#FF0000", "#0000FF", "#00FF00", "#FFFF00", "#FF9800", "#FFFFFF"];
    const wordBank = ["HOME", "WATER", "BREAD", "GRASS", "APPLE", "SMILE", "CLOCK", "CLOUD", "NIGHT", "BOOKS", "SCHOOL", "TRAIN", "PHONE", "WATCH", "CHAIR", "STREET", "FLOWER", "GARDEN", "COFFEE", "MUSIC", "PIZZA", "SHIRT"];

    const aCtx = new (window.AudioContext || window.webkitAudioContext)();
    function play(f, t, d) {
        const o = aCtx.createOscillator(), g = aCtx.createGain();
        o.connect(g); g.connect(aCtx.destination); o.type = t; o.frequency.value = f;
        g.gain.setValueAtTime(0.04, aCtx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.01, aCtx.currentTime + d);
        o.start(); o.stop(aCtx.currentTime + d);
    }

    function shuffle(arr) { return arr.sort(() => Math.random() - 0.5); }

    function resetHub() {
        clearInterval(tInt);
        document.querySelectorAll('button, input').forEach(el => el.disabled = false);
        document.getElementById('ans-in').value = '';
        document.getElementById('app').className = '';
        document.getElementById('timer-box').style.display = 'none';
        document.querySelectorAll('.view-section').forEach(v => v.classList.add('hidden'));
        document.getElementById('v-hub').classList.remove('hidden');
        drawProg();
    }

    function tryAgain() {
        curS = 0; qN = 1;
        document.querySelectorAll('.view-section').forEach(v => v.classList.add('hidden'));
        document.getElementById('v-game').classList.remove('hidden');
        if (curP === 'word') sessionWords = shuffle([...wordBank]).slice(0, 10);
        nextQ();
    }

    function goPortal(p) {
        curP = p; 
        sessionWords = shuffle([...wordBank]).slice(0, 10);
        document.querySelectorAll('.view-section').forEach(v => v.classList.add('hidden'));
        if (p === 'math') {
            document.getElementById('v-math-ops').classList.remove('hidden');
        } else {
            document.getElementById('v-opt').classList.remove('hidden');
            document.getElementById('back-from-type').onclick = resetHub;
        }
    }

    function pickMathOp(op) {
        curM = op;
        document.querySelectorAll('.view-section').forEach(v => v.classList.add('hidden'));
        document.getElementById('v-opt').classList.remove('hidden');
        document.getElementById('back-from-type').onclick = () => {
            document.querySelectorAll('.view-section').forEach(v => v.classList.add('hidden'));
            document.getElementById('v-math-ops').classList.remove('hidden');
        };
    }

    function setOpt(t) {
        curT = t;
        document.querySelectorAll('.view-section').forEach(v => v.classList.add('hidden'));
        document.getElementById('v-diff').classList.remove('hidden');
    }

    function backToType() {
        document.querySelectorAll('.view-section').forEach(v => v.classList.add('hidden'));
        document.getElementById('v-opt').classList.remove('hidden');
    }

    function start(d) {
        curD = d; curS = 0; qN = 1;
        document.querySelectorAll('.view-section').forEach(v => v.classList.add('hidden'));
        document.getElementById('v-game').classList.remove('hidden');
        nextQ();
    }

    function nextQ() {
        if(qN > 10) return end();
        document.getElementById('app').className = '';
        document.getElementById('q-cur').innerText = qN;
        document.getElementById('text-area').classList.add('hidden');
        document.getElementById('choices').classList.remove('hidden');
        document.getElementById('choices').innerHTML = '';
        document.getElementById('ans-in').value = '';
        document.getElementById('ans-in').disabled = false;
        document.getElementById('text-submit')?.removeAttribute('disabled');
        document.getElementById('q-text').style.color = 'var(--cream)';

        if(curP === 'math') genMath();
        if(curP === 'word') genWord();
        if(curP === 'color') genColor();
        if(curP === 'seq') genSeq();
        if(curP === 'patt') genPatt();

        if(curT === 'timed') startT();
    }

    function genMath() {
        let r = curD === 'god' ? 500 : 100;
        let op = curM === 'mix' ? ['add', 'sub', 'mul'][Math.floor(Math.random() * 3)] : curM;
        let n1, n2, sym;
        if(op === 'add') { n1 = rand(r); n2 = rand(r); cAns = n1 + n2; sym = '+'; }
        else if(op === 'sub') { n1 = rand(r) + 10; n2 = rand(n1); cAns = n1 - n2; sym = '-'; }
        else { n1 = rand(curD === 'god' ? 30 : 12) + 1; n2 = rand(12) + 1; cAns = n1 * n2; sym = '√ó'; }
        document.getElementById('q-text').innerText = `${n1} ${sym} ${n2}`;
        makeChoices(cAns, 'num');
    }

    function genWord() {
        document.getElementById('text-area').classList.remove('hidden');
        document.getElementById('choices').classList.add('hidden');
        let w = sessionWords[qN - 1]; cAns = w;
        let s = w.split('').sort(()=>Math.random()-0.5).join('');
        document.getElementById('q-text').innerText = s;
        document.getElementById('ans-in').focus();
    }

    function genColor() {
        let wI = rand(names.length), cI = rand(names.length);
        while(wI === cI) cI = rand(names.length);
        cAns = vColors[cI];
        let q = document.getElementById('q-text'); q.innerText = names[wI]; q.style.color = vColors[cI];
        let set = new Set([cI, wI]); while(set.size < 4) set.add(rand(vColors.length));
        Array.from(set).sort(()=>Math.random()-0.5).forEach(i => {
            const b = document.createElement('button'); b.className = 'btn-choice'; 
            b.style.backgroundColor = vColors[i]; b.innerHTML = "&nbsp;"; 
            b.onclick = () => check(vColors[i]); document.getElementById('choices').appendChild(b);
        });
    }

    function genSeq() {
        let seq = []; let l = curD === 'god' ? 5 : 3;
        for(let i=0; i<l; i++) seq.push(rand(10));
        let sStr = seq.join(''); cAns = sStr;
        document.getElementById('q-text').innerText = seq.join(' ');
        document.getElementById('choices').classList.add('hidden');
        setTimeout(() => {
            document.getElementById('q-text').innerText = "???";
            document.getElementById('choices').classList.remove('hidden');
            let set = new Set([sStr]); while(set.size < 4) set.add((parseInt(sStr)+rand(100)).toString());
            Array.from(set).sort(()=>Math.random()-0.5).forEach(v => {
                const b = document.createElement('button'); b.className = 'btn-choice'; 
                b.innerText = v; b.onclick = () => check(v); document.getElementById('choices').appendChild(b);
            });
        }, 1500);
    }

    function genPatt() {
        let mode = rand(2);
        let qArea = document.getElementById('q-text');
        if(mode === 0) {
            let start = rand(10)+1, step = rand(5)+2;
            let seq = [start, start + step, start + (step*2)]; cAns = start + (step*3);
            qArea.innerText = seq.join(' ') + ' ?'; makeChoices(cAns, 'num');
        } else {
            let count = rand(4)+1, sym = ['‚óã', '‚óè', '‚óé'][rand(3)];
            let seq = [sym.repeat(count), sym.repeat(count+1), sym.repeat(count+2)]; cAns = sym.repeat(count+3);
            qArea.innerText = seq.join(' ') + ' ?';
            let set = new Set([cAns]); while(set.size < 4) set.add(sym.repeat(rand(7)+1));
            Array.from(set).sort(()=>Math.random()-0.5).forEach(v => {
                const b = document.createElement('button'); b.className = 'btn-choice'; 
                b.innerText = v; b.onclick = () => check(v); document.getElementById('choices').appendChild(b);
            });
        }
    }

    function makeChoices(c, m) {
        let s = new Set([c]);
        while(s.size < 4) s.add(m === 'num' ? c + (rand(11)-5) : wordBank[rand(wordBank.length)]);
        Array.from(s).sort(()=>Math.random()-0.5).forEach(v => {
            const b = document.createElement('button'); b.className = 'btn-choice'; 
            b.innerText = v; b.onclick = () => check(v); document.getElementById('choices').appendChild(b);
        });
    }

    function checkText() { check(document.getElementById('ans-in').value.toUpperCase().trim()); }

    function check(v) {
        clearInterval(tInt);
        const app = document.getElementById('app'), qText = document.getElementById('q-text');
        document.querySelectorAll('button, input').forEach(el => el.disabled = true);
        if(String(v) == String(cAns)) {
            curS++; app.classList.add('f-right'); play(600, 'sine', 0.1); qText.innerText = "CORRECT!";
        } else {
            app.classList.add('f-wrong', 'shake'); play(150, 'square', 0.2);
            let displayAns = cAns;
            if(curP === 'color') displayAns = names[vColors.indexOf(cAns)];
            qText.innerText = "WRONG! IT WAS: " + displayAns; qText.style.color = "#ff8a80";
        }
        qN++; setTimeout(nextQ, 1500);
    }

    function startT() {
        let t = curD === 'god' ? 4 : 8, l = t;
        document.getElementById('timer-box').style.display = 'block';
        tInt = setInterval(() => {
            l -= 0.1; document.getElementById('timer-bar').style.width = (l/t)*100 + "%";
            if(l <= 0) { clearInterval(tInt); check('MISS'); }
        }, 100);
    }

    function end() {
        document.querySelectorAll('.view-section').forEach(v => v.classList.add('hidden'));
        document.getElementById('v-res').classList.remove('hidden');
        document.getElementById('res-score').innerText = curS;
        let pct = curS / 10, em = "ü™¥";
        if(pct === 1) em = "üèÜ"; else if(pct >= 0.8) em = "üî•"; else if(pct >= 0.5) em = "üòé";
        document.getElementById('res-emoji').innerText = em;
        save(curP, curS);
    }

    function save(p, s) {
        let d = JSON.parse(localStorage.getItem('neu_hub_final_vFinal') || '{}');
        if(!d[p]) d[p] = { t: 0, c: 0 };
        d[p].t += 10; d[p].c += s;
        localStorage.setItem('neu_hub_final_vFinal', JSON.stringify(d));
    }

    function drawProg() {
        const d = JSON.parse(localStorage.getItem('neu_hub_final_vFinal') || '{}');
        let totalP = 0, countP = 0;
        ['math','word','color','seq','patt'].forEach(p => {
            const c = document.getElementById('p-' + p);
            let pct = d[p] ? Math.round((d[p].c / d[p].t) * 100) : 0;
            totalP += pct; countP++;
            let off = 126 - (pct / 100) * 126;
            c.innerHTML = `<svg class="prog-svg"><circle class="prog-bg" cx="21" cy="21" r="20"></circle><circle class="prog-bar" cx="21" cy="21" r="20" style="stroke:var(--${p}); stroke-dasharray:126; stroke-dashoffset:${off};"></circle></svg><div class="prog-txt">${pct}%</div>`;
        });
        let avg = totalP / countP, rank = "SEEDLING";
        if(avg > 25) rank = "SPROUT"; if(avg > 50) rank = "SCHOLAR"; if(avg > 75) rank = "SAGE"; if(avg > 90) rank = "HUB MASTER";
        document.getElementById('global-rank').innerText = "RANK: " + rank;
    }

    function rand(m) { return Math.floor(Math.random() * m); }
    document.getElementById('ans-in').addEventListener('keypress', (e) => { if(e.key === 'Enter') checkText(); });
    drawProg();
</script>
</body>
</html>
