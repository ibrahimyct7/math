<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neural Hub</title>
    <style>
        :root {
            --bg: #0d1a0f;
            --panel: #162b1a;
            --cream: #f1f8e9;
            --mint: #a5d6a7;
            --btn-dark: #081209;
            /* Portal Colors */
            --math: #81c784; --word: #64b5f6; --color: #ff8a65; --seq: #ffd54f; --patt: #ce93d8; --ridd: #bcaaa4;
            /* Difficulty Colors */
            --easy: #a5d6a7; --hard: #ffb74d; --god: #ef5350;
        }

        body {
            margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg); color: var(--cream);
            display: flex; justify-content: center; align-items: center; min-height: 100vh;
            overflow: hidden; touch-action: manipulation;
        }

        #app {
            background: var(--panel); padding: 1.5rem 1rem; border-radius: 40px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.5); text-align: center;
            width: 92%; max-width: 380px; border: 1px solid rgba(255,255,255,0.05);
            position: relative; transition: background 0.3s;
        }

        #global-rank { font-size: 0.7rem; font-weight: 800; letter-spacing: 2px; color: var(--seq); margin-bottom: 5px; text-transform: uppercase; }

        .view-section { width: 100%; display: flex; flex-direction: column; align-items: center; }
        .hidden { display: none !important; }

        .portal-item {
            display: flex; align-items: center; width: 100%; 
            background: var(--btn-dark); border-radius: 25px; 
            padding: 6px 10px; margin-bottom: 8px; box-sizing: border-box;
        }
        .btn-main {
            flex-grow: 1; padding: 14px; border: none; border-radius: 18px;
            font-weight: 800; font-size: 0.9rem; cursor: pointer; text-align: left;
        }

        .prog-box { position: relative; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; margin-left: 8px; }
        .prog-svg { transform: rotate(-90deg); width: 40px; height: 40px; }
        .prog-bg { fill: none; stroke: rgba(255,255,255,0.05); stroke-width: 4; }
        .prog-bar { fill: none; stroke-width: 4; stroke-linecap: round; transition: stroke-dashoffset 0.5s ease; }
        .prog-txt { position: absolute; font-size: 0.55rem; font-weight: bold; color: var(--mint); }

        #q-text { font-size: 2.2rem; margin: 10px 0; font-weight: 900; min-height: 140px; display: flex; align-items: center; justify-content: center; text-align: center; line-height: 1.3;}
        .v-list { display: flex; flex-direction: column; gap: 8px; width: 100%; }
        button { cursor: pointer; transition: 0.2s; font-family: inherit; }
        .btn-choice { padding: 16px; border: none; border-radius: 20px; background: var(--btn-dark); color: var(--cream); font-weight: 700; font-size: 1rem; border: 1px solid rgba(255,255,255,0.05); }

        #text-area { width: 100%; max-width: 300px; }
        input[type="text"] { width: 100%; padding: 15px; border-radius: 15px; border: 2px solid var(--mint); background: var(--btn-dark); color: white; font-size: 1.2rem; text-align: center; outline: none; margin-bottom: 10px; }

        .f-right { background-color: #1e4623 !important; }
        .f-wrong { background-color: #4a1616 !important; }
        .shake { animation: shake 0.4s ease; }
        @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-8px)} 75%{transform:translateX(8px)} }

        #timer-box { width: 100%; height: 6px; background: rgba(0,0,0,0.3); border-radius: 10px; margin-bottom: 15px; display: none; overflow: hidden; }
        #timer-bar { height: 100%; background: var(--mint); width: 100%; }
        .btn-back { background: transparent; color: var(--mint); border: 1px solid rgba(255,255,255,0.1); padding: 8px; margin-top: 10px; font-size: 0.7rem; border-radius: 10px; opacity: 0.6; }
    </style>
</head>
<body>

<div id="app">
    <div id="global-rank">RANK: SEEDLING</div>
    <div id="timer-box"><div id="timer-bar"></div></div>

    <div id="v-hub" class="view-section">
        <h1 style="color:var(--mint); margin:0; font-size:1.5rem;">Neural Hub</h1>
        <p style="opacity:0.5; font-size:0.7rem; margin-bottom:15px;">Brain Maintenance Required</p>
        <div class="v-list" id="portal-list">
            <div class="portal-item"><button class="btn-main" style="background:var(--math); color:#1b3320;" onclick="goPortal('math')">MATH</button><div class="prog-box" id="p-math"></div></div>
            <div class="portal-item"><button class="btn-main" style="background:var(--word); color:#0d1b2a;" onclick="goPortal('word')">WORDS</button><div class="prog-box" id="p-word"></div></div>
            <div class="portal-item"><button class="btn-main" style="background:var(--color); color:#2d0a0a;" onclick="goPortal('color')">COLOR CLASH</button><div class="prog-box" id="p-color"></div></div>
            <div class="portal-item"><button class="btn-main" style="background:var(--seq); color:#2d240a;" onclick="goPortal('seq')">RECALL</button><div class="prog-box" id="p-seq"></div></div>
            <div class="portal-item"><button class="btn-main" style="background:var(--patt); color:#2a0d2a;" onclick="goPortal('patt')">PATTERNS</button><div class="prog-box" id="p-patt"></div></div>
            <div class="portal-item"><button class="btn-main" style="background:var(--ridd); color:#2a1b1b;" onclick="goPortal('ridd')">RIDDLES</button><div class="prog-box" id="p-ridd"></div></div>
        </div>
    </div>

    <div id="v-opt" class="view-section hidden">
        <h1 id="opt-title" style="font-size:1.1rem;">Select Mode</h1>
        <div id="type-list" class="v-list" style="margin-top:15px;">
            <button class="btn-choice" onclick="setOpt('zen')">ZEN (No Timer)</button>
            <button class="btn-choice" style="border-color:var(--hard)" onclick="setOpt('blitz')">BLITZ (Timed)</button>
        </div>
        <div id="diff-list" class="v-list hidden" style="margin-top:15px;">
            <button class="btn-choice" style="color:var(--easy)" onclick="start('easy')">EASY</button>
            <button class="btn-choice" style="color:var(--hard)" onclick="start('hard')">HARD</button>
            <button class="btn-choice" style="color:var(--god)" onclick="start('god')">GOD MODE</button>
        </div>
        <button class="btn-back" onclick="resetHub()">← BACK</button>
    </div>

    <div id="v-game" class="view-section hidden">
        <div id="q-text">--</div>
        <div id="input-area" class="v-list">
            <div id="choices" class="v-list"></div>
            <div id="text-area" class="hidden">
                <input type="text" id="ans-in" placeholder="..." autocomplete="off">
                <button class="btn-choice" style="background:var(--primary-green); width:100%" onclick="checkText()">SUBMIT</button>
            </div>
        </div>
        <button class="btn-back" onclick="resetHub()">QUIT</button>
    </div>

    <div id="v-res" class="view-section hidden">
        <h1>Done!</h1>
        <p style="font-size: 3.5rem; margin: 10px 0;"><span id="res-score">0</span>/10</p>
        <button class="btn-choice" style="width:100%" onclick="resetHub()">CONTINUE</button>
    </div>
</div>

<script>
    let curP = '', curT = '', curD = '', curS = 0, qN = 0, cAns = '', tInt;
    const names = ["RED", "BLUE", "GREEN", "YELLOW", "ORANGE", "WHITE"];
    const hex = ["#ff5252", "#448aff", "#4caf50", "#ffeb3b", "#ff9800", "#ffffff"];
    const words = ["HOME", "WATER", "BREAD", "GRASS", "APPLE", "SMILE", "CLOCK", "CLOUD", "NIGHT", "BOOKS", "TRAIN", "PHONE", "WATCH", "CHAIR"];
    
    const riddleBank = {
        easy: [
            {q: "I have a long trunk and big ears. What am I?", a: "ELEPHANT"},
            {q: "I am king of the jungle and I roar. What am I?", a: "LION"},
            {q: "I am tall with a very long neck to eat leaves. What am I?", a: "GIRAFFE"},
            {q: "I jump and have a pouch for my baby. What am I?", a: "KANGAROO"},
            {q: "I bark and I am man's best friend. What am I?", a: "DOG"},
            {q: "I am white and cold and fall from the sky.", a: "SNOW"}
        ],
        hard: [
            {q: "The more of me there is, the less you see. What am I?", a: "DARKNESS"},
            {q: "I have keys but no locks. I have a space but no room. What am I?", a: "KEYBOARD"},
            {q: "I follow you all day but you can't catch me. What am I?", a: "SHADOW"},
            {q: "I have a face and two hands, but no arms or legs.", a: "CLOCK"},
            {q: "I'm tall when I'm young, and I'm short when I'm old.", a: "CANDLE"}
        ],
        god: [
            {q: "What has to be broken before you can use it?", a: "EGG"},
            {q: "What month of the year has 28 days?", a: "ALL"},
            {q: "What is full of holes but still holds water?", a: "SPONGE"},
            {q: "What question can you never answer yes to?", a: "ASLEEP"},
            {q: "What gets wetter as it dries?", a: "TOWEL"}
        ]
    };

    const aCtx = new (window.AudioContext || window.webkitAudioContext)();
    function play(f, t, d) {
        const o = aCtx.createOscillator(), g = aCtx.createGain();
        o.connect(g); g.connect(aCtx.destination); o.type = t; o.frequency.value = f;
        g.gain.setValueAtTime(0.04, aCtx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.01, aCtx.currentTime + d);
        o.start(); o.stop(aCtx.currentTime + d);
    }

    function resetHub() {
        document.querySelectorAll('.view-section').forEach(v => v.classList.add('hidden'));
        document.getElementById('v-hub').classList.remove('hidden');
        document.getElementById('app').className = '';
        document.getElementById('timer-box').style.display = 'none';
        clearInterval(tInt); drawProg();
    }

    function goPortal(p) {
        curP = p;
        document.querySelectorAll('.view-section').forEach(v => v.classList.add('hidden'));
        document.getElementById('v-opt').classList.remove('hidden');
        document.getElementById('type-list').classList.remove('hidden');
        document.getElementById('diff-list').classList.add('hidden');
    }

    function setOpt(t) {
        curT = t;
        document.getElementById('type-list').classList.add('hidden');
        document.getElementById('diff-list').classList.remove('hidden');
    }

    function start(d) {
        curD = d; curS = 0; qN = 1;
        document.querySelectorAll('.view-section').forEach(v => v.classList.add('hidden'));
        document.getElementById('v-game').classList.remove('hidden');
        nextQ();
    }

    function nextQ() {
        if(qN > 10) return end();
        document.getElementById('app').className = '';
        document.getElementById('text-area').classList.add('hidden');
        document.getElementById('choices').classList.remove('hidden');
        document.getElementById('choices').innerHTML = '';
        document.getElementById('ans-in').value = '';
        document.getElementById('q-text').style.color = 'var(--cream)';
        document.getElementById('q-text').style.fontSize = '2.2rem';

        if(curP === 'math') genMath();
        if(curP === 'word') genWord();
        if(curP === 'color') genColor();
        if(curP === 'seq') genSeq();
        if(curP === 'patt') genPatt();
        if(curP === 'ridd') genRidd();

        if(curT === 'blitz') startT();
    }

    function genMath() {
        let r = curD === 'god' ? 500 : 100;
        let n1 = Math.floor(Math.random()*r), n2 = Math.floor(Math.random()*r);
        cAns = n1 + n2;
        document.getElementById('q-text').innerText = `${n1} + ${n2}`;
        makeChoices(cAns, 'num');
    }

    function genWord() {
        document.getElementById('text-area').classList.remove('hidden');
        document.getElementById('choices').classList.add('hidden');
        let w = words[Math.floor(Math.random()*words.length)];
        cAns = w;
        let s = w.split('').sort(()=>Math.random()-0.5).join('');
        document.getElementById('q-text').innerText = s;
        document.getElementById('ans-in').focus();
    }

    function genRidd() {
        document.getElementById('text-area').classList.remove('hidden');
        document.getElementById('choices').classList.add('hidden');
        let list = riddleBank[curD];
        let r = list[Math.floor(Math.random()*list.length)];
        cAns = r.a;
        document.getElementById('q-text').style.fontSize = '1.3rem';
        document.getElementById('q-text').innerText = r.q;
        document.getElementById('ans-in').focus();
    }

    function genColor() {
        let wI = Math.floor(Math.random()*names.length);
        let cI = Math.floor(Math.random()*names.length);
        while(wI === cI) cI = Math.floor(Math.random()*names.length);
        cAns = hex[cI];
        let q = document.getElementById('q-text');
        q.innerText = names[wI]; q.style.color = hex[cI];
        let set = new Set([cI, wI]);
        while(set.size < 4) set.add(Math.floor(Math.random()*hex.length));
        Array.from(set).sort(()=>Math.random()-0.5).forEach(i => {
            const b = document.createElement('button');
            b.className = 'btn-choice'; b.style.backgroundColor = hex[i];
            b.innerHTML = "&nbsp;"; b.onclick = () => check(hex[i]);
            document.getElementById('choices').appendChild(b);
        });
    }

    function genSeq() {
        let seq = []; let l = curD === 'god' ? 5 : (curD === 'hard' ? 4 : 3);
        for(let i=0; i<l; i++) seq.push(Math.floor(Math.random()*10));
        let sStr = seq.join(''); cAns = sStr;
        document.getElementById('q-text').innerText = seq.join(' ');
        document.getElementById('choices').classList.add('hidden');
        setTimeout(() => {
            document.getElementById('q-text').innerText = "???";
            document.getElementById('choices').classList.remove('hidden');
            let set = new Set([sStr]);
            while(set.size < 4) {
                let f = sStr.split('').sort(()=>Math.random()-0.5).join('');
                if(f === sStr) f = (parseInt(sStr)+1).toString();
                set.add(f);
            }
            Array.from(set).sort(()=>Math.random()-0.5).forEach(v => {
                const b = document.createElement('button');
                b.className = 'btn-choice'; b.innerText = v;
                b.onclick = () => check(v);
                document.getElementById('choices').appendChild(b);
            });
        }, 1500);
    }

    function genPatt() {
        let mode = Math.floor(Math.random()*2);
        let qArea = document.getElementById('q-text');
        qArea.style.fontSize = '1.8rem';
        if(mode === 0) {
            let start = Math.floor(Math.random()*10)+1; let step = Math.floor(Math.random()*5)+2;
            let seq = [start, start + step, start + (step*2)]; cAns = start + (step*3);
            qArea.innerText = seq.join(' ') + ' ?'; makeChoices(cAns, 'num');
        } else {
            let count = Math.floor(Math.random()*4)+1; let sym = ['○', '●', '◎'][Math.floor(Math.random()*3)];
            let seq = [sym.repeat(count), sym.repeat(count+1), sym.repeat(count+2)]; cAns = sym.repeat(count+3);
            qArea.innerText = seq.join(' ') + ' ?';
            let set = new Set([cAns]); while(set.size < 4) set.add(sym.repeat(Math.floor(Math.random()*7)+1));
            Array.from(set).sort(()=>Math.random()-0.5).forEach(v => {
                const b = document.createElement('button');
                b.className = 'btn-choice'; b.innerText = v;
                b.onclick = () => check(v); document.getElementById('choices').appendChild(b);
            });
        }
    }

    function makeChoices(c, m) {
        let s = new Set([c]);
        while(s.size < 4) s.add(m === 'num' ? c + (Math.floor(Math.random()*10)-5) : words[Math.floor(Math.random()*words.length)]);
        Array.from(s).sort(()=>Math.random()-0.5).forEach(v => {
            const b = document.createElement('button');
            b.className = 'btn-choice'; b.innerText = v;
            b.onclick = () => check(v);
            document.getElementById('choices').appendChild(b);
        });
    }

    function checkText() { check(document.getElementById('ans-in').value.toUpperCase().trim()); }

    function check(v) {
        clearInterval(tInt);
        const app = document.getElementById('app');
        if(String(v) == String(cAns)) {
            curS++; app.classList.add('f-right'); play(600, 'sine', 0.1);
        } else {
            app.classList.add('f-wrong', 'shake'); play(150, 'square', 0.2);
            document.getElementById('q-text').innerText = "IT WAS: " + cAns;
            document.getElementById('q-text').style.color = "var(--god)";
        }
        qN++; setTimeout(nextQ, 1200);
    }

    function startT() {
        let t = curD === 'god' ? 4 : 8; let l = t;
        document.getElementById('timer-box').style.display = 'block';
        tInt = setInterval(() => {
            l -= 0.1; document.getElementById('timer-bar').style.width = (l/t)*100 + "%";
            if(l <= 0) { clearInterval(tInt); check('MISS'); }
        }, 100);
    }

    function end() {
        document.getElementById('v-game').classList.add('hidden');
        document.getElementById('v-res').classList.remove('hidden');
        document.getElementById('res-score').innerText = curS;
        save(curP, curS);
    }

    function save(p, s) {
        let d = JSON.parse(localStorage.getItem('neu_v3') || '{}');
        if(!d[p]) d[p] = { t: 0, c: 0 };
        d[p].t += 10; d[p].c += s;
        localStorage.setItem('neu_v3', JSON.stringify(d));
    }

    function drawProg() {
        const d = JSON.parse(localStorage.getItem('neu_v3') || '{}');
        let totalP = 0, countP = 0;
        ['math','word','color','seq','patt','ridd'].forEach(p => {
            const c = document.getElementById('p-' + p);
            let pct = d[p] ? Math.round((d[p].c / d[p].t) * 100) : 0;
            totalP += pct; countP++;
            let off = 126 - (pct / 100) * 126;
            c.innerHTML = `<svg class="prog-svg"><circle class="prog-bg" cx="22" cy="22" r="20"></circle><circle class="prog-bar" cx="22" cy="22" r="20" style="stroke:var(--${p}); stroke-dasharray:126; stroke-dashoffset:${off};"></circle></svg><div class="prog-txt">${pct}%</div>`;
        });
        
        let avg = totalP / countP;
        let rank = "SEEDLING";
        if(avg > 20) rank = "SPROUT"; if(avg > 40) rank = "SCHOLAR";
        if(avg > 60) rank = "SAGE"; if(avg > 80) rank = "MASTER HUB";
        document.getElementById('global-rank').innerText = "RANK: " + rank;
    }

    document.getElementById('ans-in').addEventListener('keypress', (e) => { if(e.key === 'Enter') checkText(); });
    drawProg();
</script>
</body>
</html>
